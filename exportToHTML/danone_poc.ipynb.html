<html>
<head>
<title>danone_poc.ipynb</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.s0 { color: #6c7086; font-style: italic;}
.s1 { color: #cba6f7;}
.s2 { color: #cdd6f4;}
.s3 { color: #9399b2;}
.s4 { color: #fab387;}
.s5 { color: #89dceb;}
.s6 { color: #a6e3a1;}
</style>
</head>
<body bgcolor="#1e1e2e">
<table CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<tr><td><center>
<font face="Arial, Helvetica" color="#000000">
danone_poc.ipynb</font>
</center></td></tr></table>
<pre><span class="s0">#%% 
</span><span class="s1">import </span><span class="s2">matplotlib</span><span class="s3">.</span><span class="s2">pyplot </span><span class="s1">as </span><span class="s2">plt</span>
<span class="s1">import </span><span class="s2">numpy </span><span class="s1">as </span><span class="s2">np</span>
<span class="s1">import </span><span class="s2">pandas </span><span class="s1">as </span><span class="s2">pd</span>
<span class="s1">import </span><span class="s2">seaborn </span><span class="s1">as </span><span class="s2">sns</span>
<span class="s1">from </span><span class="s2">scipy</span><span class="s3">.</span><span class="s2">optimize </span><span class="s1">import </span><span class="s2">minimize</span>
<span class="s1">from </span><span class="s2">sklearn</span><span class="s3">.</span><span class="s2">linear_model </span><span class="s1">import </span><span class="s2">LinearRegression</span>
<span class="s1">from </span><span class="s2">sklearn</span><span class="s3">.</span><span class="s2">model_selection </span><span class="s1">import </span><span class="s2">train_test_split</span>
<span class="s0">#%% 
# Seed for reproducibility</span>
<span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">seed</span><span class="s3">(</span><span class="s4">42</span><span class="s3">)</span>
<span class="s2">num_samples </span><span class="s5">= </span><span class="s4">100</span>

<span class="s0"># Generate random data for each variable</span>
<span class="s2">humidity </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">uniform</span><span class="s3">(</span><span class="s4">30</span><span class="s3">, </span><span class="s4">70</span><span class="s3">, </span><span class="s2">num_samples</span><span class="s3">)  </span><span class="s0"># in percentage</span>
<span class="s2">oven_temp </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">uniform</span><span class="s3">(</span><span class="s4">150</span><span class="s3">, </span><span class="s4">250</span><span class="s3">, </span><span class="s2">num_samples</span><span class="s3">)  </span><span class="s0"># in Celsius</span>
<span class="s2">mixing_time </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">uniform</span><span class="s3">(</span><span class="s4">10</span><span class="s3">, </span><span class="s4">60</span><span class="s3">, </span><span class="s2">num_samples</span><span class="s3">)  </span><span class="s0"># in minutes</span>
<span class="s2">ingredient_quality </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">uniform</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s2">num_samples</span><span class="s3">)  </span><span class="s0"># quality score (0 to 1)</span>
<span class="s2">batch_size </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">uniform</span><span class="s3">(</span><span class="s4">500</span><span class="s3">, </span><span class="s4">1500</span><span class="s3">, </span><span class="s2">num_samples</span><span class="s3">)  </span><span class="s0"># in kg</span>
<span class="s2">worker_experience </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">uniform</span><span class="s3">(</span><span class="s4">1</span><span class="s3">, </span><span class="s4">10</span><span class="s3">, </span><span class="s2">num_samples</span><span class="s3">)  </span><span class="s0"># in years</span>
<span class="s2">machine_efficiency </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">uniform</span><span class="s3">(</span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">1</span><span class="s3">, </span><span class="s2">num_samples</span><span class="s3">)  </span><span class="s0"># efficiency ratio (0.8 to 1)</span>
<span class="s2">ingredient_cost </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">uniform</span><span class="s3">(</span><span class="s4">50</span><span class="s3">, </span><span class="s4">200</span><span class="s3">, </span><span class="s2">num_samples</span><span class="s3">)  </span><span class="s0"># cost in dollars</span>
<span class="s2">downtime </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">uniform</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s2">num_samples</span><span class="s3">)  </span><span class="s0"># downtime in hours</span>
<span class="s2">ambient_temperature </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">uniform</span><span class="s3">(</span><span class="s4">15</span><span class="s3">, </span><span class="s4">35</span><span class="s3">, </span><span class="s2">num_samples</span><span class="s3">)  </span><span class="s0"># in Celsius</span>

<span class="s0"># Define weights for each variable indicating their impact on production</span>
<span class="s2">gen_weights </span><span class="s5">= </span><span class="s3">{</span>
    <span class="s6">&quot;humidity&quot;</span><span class="s5">: -</span><span class="s4">0.5</span><span class="s3">,</span>
    <span class="s6">&quot;oven_temp&quot;</span><span class="s5">: </span><span class="s4">1.2</span><span class="s3">,</span>
    <span class="s6">&quot;mixing_time&quot;</span><span class="s5">: </span><span class="s4">0.8</span><span class="s3">,</span>
    <span class="s6">&quot;ingredient_quality&quot;</span><span class="s5">: </span><span class="s4">2.5</span><span class="s3">,</span>
    <span class="s6">&quot;batch_size&quot;</span><span class="s5">: </span><span class="s4">0.05</span><span class="s3">,</span>
    <span class="s6">&quot;worker_experience&quot;</span><span class="s5">: </span><span class="s4">1.0</span><span class="s3">,</span>
    <span class="s6">&quot;machine_efficiency&quot;</span><span class="s5">: </span><span class="s4">3.0</span><span class="s3">,</span>
    <span class="s6">&quot;ingredient_cost&quot;</span><span class="s5">: -</span><span class="s4">0.01</span><span class="s3">,</span>
    <span class="s6">&quot;downtime&quot;</span><span class="s5">: -</span><span class="s4">2.0</span><span class="s3">,</span>
    <span class="s6">&quot;ambient_temperature&quot;</span><span class="s5">: </span><span class="s4">0.3</span>
<span class="s3">}</span>

<span class="s0"># Compute the production output</span>
<span class="s2">production_output </span><span class="s5">= </span><span class="s3">(</span>
        <span class="s2">gen_weights</span><span class="s3">[</span><span class="s6">&quot;humidity&quot;</span><span class="s3">] </span><span class="s5">* </span><span class="s2">humidity </span><span class="s5">+</span>
        <span class="s2">gen_weights</span><span class="s3">[</span><span class="s6">&quot;oven_temp&quot;</span><span class="s3">] </span><span class="s5">* </span><span class="s2">oven_temp </span><span class="s5">+</span>
        <span class="s2">gen_weights</span><span class="s3">[</span><span class="s6">&quot;mixing_time&quot;</span><span class="s3">] </span><span class="s5">* </span><span class="s2">mixing_time </span><span class="s5">+</span>
        <span class="s2">gen_weights</span><span class="s3">[</span><span class="s6">&quot;ingredient_quality&quot;</span><span class="s3">] </span><span class="s5">* </span><span class="s2">ingredient_quality </span><span class="s5">+</span>
        <span class="s2">gen_weights</span><span class="s3">[</span><span class="s6">&quot;batch_size&quot;</span><span class="s3">] </span><span class="s5">* </span><span class="s2">batch_size </span><span class="s5">+</span>
        <span class="s2">gen_weights</span><span class="s3">[</span><span class="s6">&quot;worker_experience&quot;</span><span class="s3">] </span><span class="s5">* </span><span class="s2">worker_experience </span><span class="s5">+</span>
        <span class="s2">gen_weights</span><span class="s3">[</span><span class="s6">&quot;machine_efficiency&quot;</span><span class="s3">] </span><span class="s5">* </span><span class="s2">machine_efficiency </span><span class="s5">+</span>
        <span class="s2">gen_weights</span><span class="s3">[</span><span class="s6">&quot;ingredient_cost&quot;</span><span class="s3">] </span><span class="s5">* </span><span class="s2">ingredient_cost </span><span class="s5">+</span>
        <span class="s2">gen_weights</span><span class="s3">[</span><span class="s6">&quot;downtime&quot;</span><span class="s3">] </span><span class="s5">* </span><span class="s2">downtime </span><span class="s5">+</span>
        <span class="s2">gen_weights</span><span class="s3">[</span><span class="s6">&quot;ambient_temperature&quot;</span><span class="s3">] </span><span class="s5">* </span><span class="s2">ambient_temperature </span><span class="s5">+</span>
        <span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">normal</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s2">num_samples</span><span class="s3">)  </span><span class="s0"># adding some noise</span>
<span class="s3">)</span>

<span class="s0"># Create a DataFrame</span>
<span class="s2">data </span><span class="s5">= </span><span class="s3">{</span>
    <span class="s6">&quot;Humidity&quot;</span><span class="s5">: </span><span class="s2">humidity</span><span class="s3">,</span>
    <span class="s6">&quot;Oven Temperature&quot;</span><span class="s5">: </span><span class="s2">oven_temp</span><span class="s3">,</span>
    <span class="s6">&quot;Mixing Time&quot;</span><span class="s5">: </span><span class="s2">mixing_time</span><span class="s3">,</span>
    <span class="s6">&quot;Ingredient Quality&quot;</span><span class="s5">: </span><span class="s2">ingredient_quality</span><span class="s3">,</span>
    <span class="s6">&quot;Batch Size&quot;</span><span class="s5">: </span><span class="s2">batch_size</span><span class="s3">,</span>
    <span class="s6">&quot;Worker Experience&quot;</span><span class="s5">: </span><span class="s2">worker_experience</span><span class="s3">,</span>
    <span class="s6">&quot;Machine Efficiency&quot;</span><span class="s5">: </span><span class="s2">machine_efficiency</span><span class="s3">,</span>
    <span class="s6">&quot;Ingredient Cost&quot;</span><span class="s5">: </span><span class="s2">ingredient_cost</span><span class="s3">,</span>
    <span class="s6">&quot;Downtime&quot;</span><span class="s5">: </span><span class="s2">downtime</span><span class="s3">,</span>
    <span class="s6">&quot;Ambient Temperature&quot;</span><span class="s5">: </span><span class="s2">ambient_temperature</span><span class="s3">,</span>
    <span class="s6">&quot;Production Output&quot;</span><span class="s5">: </span><span class="s2">production_output</span>
<span class="s3">}</span>

<span class="s2">df </span><span class="s5">= </span><span class="s2">pd</span><span class="s3">.</span><span class="s2">DataFrame</span><span class="s3">(</span><span class="s2">data</span><span class="s3">)</span>
<span class="s2">df</span><span class="s3">.</span><span class="s2">head</span><span class="s3">()</span>
<span class="s0">#%% 
</span><span class="s2">df</span><span class="s3">.</span><span class="s2">describe</span><span class="s3">()</span>
<span class="s0">#%% 
# Generate correlation matrix</span>
<span class="s2">correlation_matrix </span><span class="s5">= </span><span class="s2">df</span><span class="s3">.</span><span class="s2">corr</span><span class="s3">()</span>

<span class="s0"># Plot the correlation matrix</span>
<span class="s2">plt</span><span class="s3">.</span><span class="s2">figure</span><span class="s3">(</span><span class="s2">figsize</span><span class="s5">=</span><span class="s3">(</span><span class="s4">12</span><span class="s3">, </span><span class="s4">8</span><span class="s3">))</span>
<span class="s2">sns</span><span class="s3">.</span><span class="s2">heatmap</span><span class="s3">(</span><span class="s2">correlation_matrix</span><span class="s3">, </span><span class="s2">annot</span><span class="s5">=</span><span class="s1">True</span><span class="s3">, </span><span class="s2">cmap</span><span class="s5">=</span><span class="s6">'coolwarm'</span><span class="s3">, </span><span class="s2">fmt</span><span class="s5">=</span><span class="s6">&quot;.2f&quot;</span><span class="s3">)</span>
<span class="s2">plt</span><span class="s3">.</span><span class="s2">title</span><span class="s3">(</span><span class="s6">'Correlation Matrix for Baby Powder Production Variables'</span><span class="s3">)</span>
<span class="s2">plt</span><span class="s3">.</span><span class="s2">show</span><span class="s3">()</span>
<span class="s0">#%% 
# Separate features and target variable</span>
<span class="s2">X </span><span class="s5">= </span><span class="s2">df</span><span class="s3">.</span><span class="s2">drop</span><span class="s3">(</span><span class="s2">columns</span><span class="s5">=</span><span class="s6">&quot;Production Output&quot;</span><span class="s3">)</span>
<span class="s2">y </span><span class="s5">= </span><span class="s2">df</span><span class="s3">[</span><span class="s6">&quot;Production Output&quot;</span><span class="s3">]</span>

<span class="s0"># Split the data into training and testing sets</span>
<span class="s2">X_train</span><span class="s3">, </span><span class="s2">X_test</span><span class="s3">, </span><span class="s2">y_train</span><span class="s3">, </span><span class="s2">y_test </span><span class="s5">= </span><span class="s2">train_test_split</span><span class="s3">(</span><span class="s2">X</span><span class="s3">, </span><span class="s2">y</span><span class="s3">, </span><span class="s2">test_size</span><span class="s5">=</span><span class="s4">0.2</span><span class="s3">, </span><span class="s2">random_state</span><span class="s5">=</span><span class="s4">42</span><span class="s3">)</span>

<span class="s0"># Create and train the linear regression model</span>
<span class="s2">model </span><span class="s5">= </span><span class="s2">LinearRegression</span><span class="s3">()</span>
<span class="s2">model</span><span class="s3">.</span><span class="s2">fit</span><span class="s3">(</span><span class="s2">X_train</span><span class="s3">, </span><span class="s2">y_train</span><span class="s3">)</span>

<span class="s0"># Get the coefficients (weights)</span>
<span class="s2">weights </span><span class="s5">= </span><span class="s2">model</span><span class="s3">.</span><span class="s2">coef_</span>
<span class="s2">intercept </span><span class="s5">= </span><span class="s2">model</span><span class="s3">.</span><span class="s2">intercept_</span>

<span class="s0"># Create a DataFrame for better readability</span>
<span class="s2">weight_df </span><span class="s5">= </span><span class="s2">pd</span><span class="s3">.</span><span class="s2">DataFrame</span><span class="s3">({</span>
    <span class="s6">&quot;Variable&quot;</span><span class="s5">: </span><span class="s2">X</span><span class="s3">.</span><span class="s2">columns</span><span class="s3">,</span>
    <span class="s6">&quot;Weight&quot;</span><span class="s5">: </span><span class="s2">weights</span>
<span class="s3">})</span>

<span class="s2">print</span><span class="s3">(</span><span class="s6">&quot;Intercept:&quot;</span><span class="s3">, </span><span class="s2">intercept</span><span class="s3">)</span>
<span class="s0"># print([f'{x:.2f}' for x in weights])</span>
<span class="s0"># print(gen_weights.values())</span>
<span class="s2">weight_df</span>
<span class="s0">#%% 
</span><span class="s2">gen_weights</span>
<span class="s0">#%% 
# Convert weights to a numpy array for easy multiplication</span>
<span class="s2">original_weights_array </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">array</span><span class="s3">(</span><span class="s2">list</span><span class="s3">(</span><span class="s2">gen_weights</span><span class="s3">.</span><span class="s2">values</span><span class="s3">()))</span>

<span class="s0"># Predicted production output using original weights</span>
<span class="s2">y_pred_original </span><span class="s5">= </span><span class="s2">X</span><span class="s3">.</span><span class="s2">dot</span><span class="s3">(</span><span class="s2">original_weights_array</span><span class="s3">) </span><span class="s5">+ </span><span class="s2">np</span><span class="s3">.</span><span class="s2">random</span><span class="s3">.</span><span class="s2">normal</span><span class="s3">(</span><span class="s4">0</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s2">len</span><span class="s3">(</span><span class="s2">X</span><span class="s3">))</span>

<span class="s0"># Predict using the estimated weights</span>
<span class="s2">y_pred_estimated </span><span class="s5">= </span><span class="s2">model</span><span class="s3">.</span><span class="s2">predict</span><span class="s3">(</span><span class="s2">X</span><span class="s3">)</span>
<span class="s0"># Sort the data by the actual production output</span>
<span class="s2">sorted_indices </span><span class="s5">= </span><span class="s2">y</span><span class="s3">.</span><span class="s2">argsort</span><span class="s3">()</span>
<span class="s2">y_sorted </span><span class="s5">= </span><span class="s2">y</span><span class="s3">.</span><span class="s2">iloc</span><span class="s3">[</span><span class="s2">sorted_indices</span><span class="s3">]</span>
<span class="s2">y_pred_original_sorted </span><span class="s5">= </span><span class="s2">y_pred_original</span><span class="s3">[</span><span class="s2">sorted_indices</span><span class="s3">]</span>
<span class="s2">y_pred_estimated_sorted </span><span class="s5">= </span><span class="s2">y_pred_estimated</span><span class="s3">[</span><span class="s2">sorted_indices</span><span class="s3">]</span>

<span class="s0"># Plotting</span>
<span class="s2">plt</span><span class="s3">.</span><span class="s2">figure</span><span class="s3">(</span><span class="s2">figsize</span><span class="s5">=</span><span class="s3">(</span><span class="s4">14</span><span class="s3">, </span><span class="s4">8</span><span class="s3">))</span>

<span class="s0"># Plot the actual production output</span>
<span class="s2">plt</span><span class="s3">.</span><span class="s2">plot</span><span class="s3">(</span><span class="s2">range</span><span class="s3">(</span><span class="s2">len</span><span class="s3">(</span><span class="s2">y</span><span class="s3">)), </span><span class="s2">y_sorted</span><span class="s3">, </span><span class="s2">color</span><span class="s5">=</span><span class="s6">'blue'</span><span class="s3">, </span><span class="s2">linestyle</span><span class="s5">=</span><span class="s6">''</span><span class="s3">, </span><span class="s2">marker</span><span class="s5">=</span><span class="s6">'o'</span><span class="s3">, </span><span class="s2">alpha</span><span class="s5">=</span><span class="s4">0.5</span><span class="s3">, </span><span class="s2">label</span><span class="s5">=</span><span class="s6">'Actual Production Output'</span><span class="s3">)</span>

<span class="s0"># Plot the output from the original function</span>
<span class="s2">plt</span><span class="s3">.</span><span class="s2">plot</span><span class="s3">(</span><span class="s2">range</span><span class="s3">(</span><span class="s2">len</span><span class="s3">(</span><span class="s2">y</span><span class="s3">)), </span><span class="s2">y_pred_original_sorted</span><span class="s3">, </span><span class="s2">color</span><span class="s5">=</span><span class="s6">'green'</span><span class="s3">, </span><span class="s2">linestyle</span><span class="s5">=</span><span class="s6">'--'</span><span class="s3">, </span><span class="s2">linewidth</span><span class="s5">=</span><span class="s4">2</span><span class="s3">,</span>
         <span class="s2">label</span><span class="s5">=</span><span class="s6">'Original Function Output'</span><span class="s3">)</span>

<span class="s0"># Plot the output from the estimated weights</span>
<span class="s2">plt</span><span class="s3">.</span><span class="s2">plot</span><span class="s3">(</span><span class="s2">range</span><span class="s3">(</span><span class="s2">len</span><span class="s3">(</span><span class="s2">y</span><span class="s3">)), </span><span class="s2">y_pred_estimated_sorted</span><span class="s3">, </span><span class="s2">color</span><span class="s5">=</span><span class="s6">'red'</span><span class="s3">, </span><span class="s2">linestyle</span><span class="s5">=</span><span class="s6">'-'</span><span class="s3">, </span><span class="s2">linewidth</span><span class="s5">=</span><span class="s4">2</span><span class="s3">,</span>
         <span class="s2">label</span><span class="s5">=</span><span class="s6">'Estimated Weights Output'</span><span class="s3">)</span>

<span class="s2">plt</span><span class="s3">.</span><span class="s2">xlabel</span><span class="s3">(</span><span class="s6">'Sample Index (sorted by actual output)'</span><span class="s3">)</span>
<span class="s2">plt</span><span class="s3">.</span><span class="s2">ylabel</span><span class="s3">(</span><span class="s6">'Production Output'</span><span class="s3">)</span>
<span class="s2">plt</span><span class="s3">.</span><span class="s2">title</span><span class="s3">(</span><span class="s6">'Production Output: Actual vs. Predicted'</span><span class="s3">)</span>
<span class="s2">plt</span><span class="s3">.</span><span class="s2">legend</span><span class="s3">()</span>
<span class="s2">plt</span><span class="s3">.</span><span class="s2">show</span><span class="s3">()</span>

<span class="s0">#%% 
# Define the original function</span>
<span class="s1">def </span><span class="s2">original_function</span><span class="s3">(</span><span class="s2">x</span><span class="s3">)</span><span class="s5">:</span>
    <span class="s2">weights </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">array</span><span class="s3">([</span><span class="s5">-</span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">1.2</span><span class="s3">, </span><span class="s4">0.8</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">, </span><span class="s4">0.05</span><span class="s3">, </span><span class="s4">1.0</span><span class="s3">, </span><span class="s4">3.0</span><span class="s3">, </span><span class="s5">-</span><span class="s4">0.01</span><span class="s3">, </span><span class="s5">-</span><span class="s4">2.0</span><span class="s3">, </span><span class="s4">0.3</span><span class="s3">])</span>
    <span class="s1">return </span><span class="s5">-</span><span class="s2">np</span><span class="s3">.</span><span class="s2">dot</span><span class="s3">(</span><span class="s2">weights</span><span class="s3">, </span><span class="s2">x</span><span class="s3">)  </span><span class="s0"># Negative for maximization</span>


<span class="s0"># Define the estimated function using the estimated weights from the trained model</span>
<span class="s1">def </span><span class="s2">estimated_function</span><span class="s3">(</span><span class="s2">x</span><span class="s3">, </span><span class="s2">model</span><span class="s3">)</span><span class="s5">:</span>
    <span class="s2">x_df </span><span class="s5">= </span><span class="s2">pd</span><span class="s3">.</span><span class="s2">DataFrame</span><span class="s3">([</span><span class="s2">x</span><span class="s3">], </span><span class="s2">columns</span><span class="s5">=</span><span class="s2">model</span><span class="s3">.</span><span class="s2">feature_names_in_</span><span class="s3">)</span>
    <span class="s1">return </span><span class="s5">-</span><span class="s2">model</span><span class="s3">.</span><span class="s2">predict</span><span class="s3">(</span><span class="s2">x_df</span><span class="s3">)[</span><span class="s4">0</span><span class="s3">]  </span><span class="s0"># Negative for maximization</span>


<span class="s0"># Define the constraints and bounds</span>
<span class="s2">constraints </span><span class="s5">= </span><span class="s3">[]</span>
<span class="s0"># Compute bounds based on the range of each feature in the dataset</span>
<span class="s2">bounds </span><span class="s5">= </span><span class="s3">[(</span><span class="s2">X</span><span class="s3">[</span><span class="s2">col</span><span class="s3">].</span><span class="s2">min</span><span class="s3">(), </span><span class="s2">X</span><span class="s3">[</span><span class="s2">col</span><span class="s3">].</span><span class="s2">max</span><span class="s3">()) </span><span class="s1">for </span><span class="s2">col </span><span class="s1">in </span><span class="s2">X</span><span class="s3">.</span><span class="s2">columns</span><span class="s3">]</span>

<span class="s0"># Initial guess</span>
<span class="s2">initial_guess </span><span class="s5">= </span><span class="s2">np</span><span class="s3">.</span><span class="s2">array</span><span class="s3">([</span><span class="s4">50</span><span class="s3">, </span><span class="s4">200</span><span class="s3">, </span><span class="s4">35</span><span class="s3">, </span><span class="s4">0.5</span><span class="s3">, </span><span class="s4">1000</span><span class="s3">, </span><span class="s4">5</span><span class="s3">, </span><span class="s4">0.9</span><span class="s3">, </span><span class="s4">125</span><span class="s3">, </span><span class="s4">2.5</span><span class="s3">, </span><span class="s4">25</span><span class="s3">])</span>

<span class="s0"># Find the optimal inputs for the original function</span>
<span class="s2">result_original </span><span class="s5">= </span><span class="s2">minimize</span><span class="s3">(</span><span class="s2">original_function</span><span class="s3">, </span><span class="s2">initial_guess</span><span class="s3">, </span><span class="s2">bounds</span><span class="s5">=</span><span class="s2">bounds</span><span class="s3">, </span><span class="s2">constraints</span><span class="s5">=</span><span class="s2">constraints</span><span class="s3">)</span>
<span class="s2">optimal_inputs_original </span><span class="s5">= </span><span class="s2">result_original</span><span class="s3">.</span><span class="s2">x</span>

<span class="s0"># Find the optimal inputs for the estimated function</span>
<span class="s2">result_estimated </span><span class="s5">= </span><span class="s2">minimize</span><span class="s3">(</span><span class="s2">estimated_function</span><span class="s3">, </span><span class="s2">initial_guess</span><span class="s3">, </span><span class="s2">args</span><span class="s5">=</span><span class="s3">(</span><span class="s2">model</span><span class="s3">,), </span><span class="s2">bounds</span><span class="s5">=</span><span class="s2">bounds</span><span class="s3">, </span><span class="s2">constraints</span><span class="s5">=</span><span class="s2">constraints</span><span class="s3">)</span>
<span class="s2">optimal_inputs_estimated </span><span class="s5">= </span><span class="s2">result_estimated</span><span class="s3">.</span><span class="s2">x</span>
<span class="s0">#%% 
</span><span class="s2">optimal_inputs_df </span><span class="s5">= </span><span class="s2">pd</span><span class="s3">.</span><span class="s2">DataFrame</span><span class="s3">({</span>
    <span class="s6">&quot;Variable&quot;</span><span class="s5">: </span><span class="s2">X</span><span class="s3">.</span><span class="s2">columns</span><span class="s3">,</span>
    <span class="s6">&quot;Optimal Input (Original Function)&quot;</span><span class="s5">: </span><span class="s2">optimal_inputs_original</span><span class="s3">,</span>
    <span class="s6">&quot;Optimal Input (Estimated Function)&quot;</span><span class="s5">: </span><span class="s2">optimal_inputs_estimated</span>
<span class="s3">})</span>
<span class="s2">print</span><span class="s3">(</span><span class="s6">&quot;Optimal output (Original):&quot;</span><span class="s3">, </span><span class="s5">-</span><span class="s2">original_function</span><span class="s3">(</span><span class="s2">optimal_inputs_original</span><span class="s3">))</span>
<span class="s2">print</span><span class="s3">(</span><span class="s6">&quot;Optimal output (Estimated):&quot;</span><span class="s3">, </span><span class="s5">-</span><span class="s2">estimated_function</span><span class="s3">(</span><span class="s2">optimal_inputs_estimated</span><span class="s3">, </span><span class="s2">model</span><span class="s3">))</span>
<span class="s2">optimal_inputs_df</span></pre>
</body>
</html>